{% load static %}
<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="{% static 'inicio/css/global.css' %}" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
  <title>Dieta - Nutra</title>
  <style>
    .diet-header {
      background: #0d7a00;
      color: #fff;
      padding: 20px;
      border-radius: 0 0 20px 20px;
      box-shadow: 0 4px 15px rgba(10, 94, 0, 0.3);
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      z-index: 999;
      margin-bottom: 20px;
    }
    
    .header-content {
      display: flex;
      align-items: center;
      justify-content: space-between;
      max-width: 400px;
      margin: 0 auto;
    }
    
    .logo {
      font-size: 24px;
      font-weight: bold;
      letter-spacing: 2px;
    }
    
    .date-navigation {
      display: flex;
      align-items: center;
      gap: 20px;
    }
    
    .nav-arrow {
      background: none;
      border: none;
      color: #fff;
      font-size: 20px;
      cursor: pointer;
      padding: 8px;
      border-radius: 50%;
      transition: all 0.3s ease;
    }
    
    .nav-arrow:hover {
      background: rgba(255, 255, 255, 0.1);
      transform: scale(1.1);
    }
    
    .current-date {
      font-size: 18px;
      font-weight: bold;
    }
    
    .daily-goal-card {
      background: #2a2a2a;
      border-radius: 20px;
      margin: 20px auto;
      padding: 25px;
      box-shadow: 0 6px 20px rgba(143, 209, 158, 0.1);
      border: 1px solid rgba(143, 209, 158, 0.2);
      max-width: 100%;
      width: 100%;
      box-sizing: border-box;
    }
    
    .goal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 25px;
    }
    
    .goal-title {
      color: #8fd19e;
      font-size: 18px;
      font-weight: bold;
    }
    
    .edit-goal-btn {
      background: none;
      border: none;
      color: #8fd19e;
      cursor: pointer;
      font-size: 14px;
      display: flex;
      align-items: center;
      gap: 5px;
      transition: color 0.3s ease;
    }
    
    .edit-goal-btn:hover {
      color: #7bc08a;
    }
    
    .calorie-summary {
      display: flex;
      align-items: center;
      justify-content: center;
      margin-bottom: 30px;
    }
    
    .calorie-circle {
      width: 120px;
      height: 120px;
      border-radius: 50%;
      background: #333;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      position: relative;
      margin: 0 20px;
      transition: all 0.5s ease;
    }
    
    .calorie-circle::before {
      content: '';
      position: absolute;
      width: 80px;
      height: 80px;
      background: #2a2a2a;
      border-radius: 50%;
      z-index: 1;
    }
    
    .calorie-circle::after {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      border-radius: 50%;
      background: conic-gradient(
        #8fd19e 0deg, 
        #8fd19e var(--progress-green, 0deg), 
        #e74c3c var(--progress-green, 0deg), 
        #e74c3c var(--progress-total, 0deg), 
        transparent var(--progress-total, 0deg)
      );
      z-index: 0;
      transition: all 0.8s ease;
    }
    
    .calorie-circle.exceeded::after {
      background: conic-gradient(
        #e74c3c 0deg, 
        #e74c3c var(--progress-green, 0deg), 
        #e74c3c var(--progress-green, 0deg), 
        #e74c3c var(--progress-total, 0deg), 
        transparent var(--progress-total, 0deg)
      );
    }
    
    .calorie-circle.exceeded .calorie-content {
      color: #e74c3c;
    }
    
    .calorie-content {
      position: relative;
      z-index: 2;
      text-align: center;
    }
    
    .calorie-remaining {
      color: #8fd19e;
      font-size: 24px;
      font-weight: bold;
      margin-bottom: 5px;
    }
    
    .calorie-label {
      color: #888;
      font-size: 12px;
    }
    
    .calorie-consumed {
      color: #fff;
      font-size: 18px;
      font-weight: bold;
      margin-bottom: 5px;
    }
    
    .calorie-consumed-label {
      color: #888;
      font-size: 14px;
    }
    
    .macros-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 15px;
      margin-bottom: 25px;
      width: 100%;
      box-sizing: border-box;
    }
    
    .macro-card {
      background: #333;
      border-radius: 12px;
      padding: 15px;
      text-align: center;
      position: relative;
      overflow: hidden;
    }
    
    .macro-name {
      color: #888;
      font-size: 14px;
      margin-bottom: 8px;
    }
    
    .macro-value {
      color: #8fd19e;
      font-size: 18px;
      font-weight: bold;
      position: relative;
      z-index: 2;
    }
    
    .macro-remaining {
      color: #888;
      font-size: 12px;
      margin-top: 4px;
      position: relative;
      z-index: 2;
    }
    
    .macro-progress-bar {
      position: absolute;
      bottom: 0;
      left: 0;
      height: 100%;
      width: 0%;
      background: #8fd19e;
      opacity: 0.3;
      border-radius: 12px;
      transition: width 0.8s ease;
      z-index: 1;
    }
    
    .macro-progress-bar.exceeded {
      background: #e74c3c;
    }
    
    .macro-card.exceeded .macro-value {
      color: #e74c3c;
    }
    
    .meal-card {
      background: #2a2a2a;
      border-radius: 15px;
      padding: 20px;
      margin: 20px 0;
      box-shadow: 0 4px 15px rgba(143, 209, 158, 0.1);
      border: 1px solid rgba(143, 209, 158, 0.2);
    }
    
    .meal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 15px;
      padding-bottom: 10px;
      border-bottom: 1px solid #444;
    }
    
    .meal-actions {
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .meal-buttons {
      display: flex;
      gap: 5px;
    }
    
    .edit-meal-btn, .delete-meal-btn {
      background: none;
      border: none;
      color: #888;
      cursor: pointer;
      padding: 5px;
      border-radius: 4px;
      transition: all 0.3s ease;
      font-size: 14px;
    }
    
    .edit-meal-btn {
      background: rgba(143, 209, 158, 0.1);
      border: 1px solid rgba(143, 209, 158, 0.3);
      color: #8fd19e;
      padding: 6px 8px;
      border-radius: 6px;
      font-size: 13px;
      font-weight: 500;
    }
    
    .edit-meal-btn:hover {
      background: rgba(143, 209, 158, 0.2);
      border-color: #8fd19e;
      color: #fff;
      transform: translateY(-1px);
      box-shadow: 0 2px 8px rgba(143, 209, 158, 0.3);
      animation: pulse-green 0.6s ease-in-out;
    }
    
    @keyframes pulse-green {
      0% { transform: translateY(-1px) scale(1); }
      50% { transform: translateY(-1px) scale(1.05); }
      100% { transform: translateY(-1px) scale(1); }
    }
    
    .delete-meal-btn {
      background: rgba(231, 76, 60, 0.1);
      border: 1px solid rgba(231, 76, 60, 0.3);
      color: #e74c3c;
      padding: 6px 8px;
      border-radius: 6px;
      font-size: 13px;
      font-weight: 500;
    }
    
    .delete-meal-btn:hover {
      background: rgba(231, 76, 60, 0.2);
      border-color: #e74c3c;
      color: #fff;
      transform: translateY(-1px);
      box-shadow: 0 2px 8px rgba(231, 76, 60, 0.3);
      animation: pulse-red 0.6s ease-in-out;
    }
    
    @keyframes pulse-red {
      0% { transform: translateY(-1px) scale(1); }
      50% { transform: translateY(-1px) scale(1.05); }
      100% { transform: translateY(-1px) scale(1); }
    }
    
    /* Responsividade para botões de refeição */
    @media (max-width: 480px) {
      .meal-actions {
        flex-direction: column;
        gap: 5px;
        align-items: flex-end;
      }
      
      .meal-buttons {
        gap: 8px;
      }
      
      .edit-meal-btn, .delete-meal-btn {
        padding: 8px 10px;
        font-size: 14px;
        border-radius: 8px;
      }
    }
    
    .meal-name {
      color: #8fd19e;
      font-size: 18px;
      font-weight: bold;
    }
    
    .meal-calories {
      color: #8fd19e;
      font-size: 16px;
      font-weight: bold;
    }
    
    .meal-items {
      margin-bottom: 15px;
    }
    
    .meal-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 10px 0;
      border-bottom: 1px solid #333;
    }
    
    .meal-item:last-child {
      border-bottom: none;
    }
    
    .item-info {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }
    
    .item-name {
      color: #fff;
      font-size: 14px;
      font-weight: 500;
    }
    
    .item-quantity {
      color: #888;
      font-size: 12px;
    }
    
    .item-nutrition {
      display: flex;
      flex-direction: column;
      align-items: flex-end;
      gap: 4px;
    }
    
    .nutrition-value {
      color: #8fd19e;
      font-size: 14px;
      font-weight: bold;
    }
    
    .nutrition-details {
      color: #888;
      font-size: 11px;
    }
    
    .meal-totals {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 10px;
      padding-top: 15px;
      border-top: 1px solid #444;
    }
    
    .total-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 8px 0;
    }
    
    .total-label {
      color: #ccc;
      font-size: 13px;
    }
    
    .total-value {
      color: #8fd19e;
      font-size: 13px;
      font-weight: bold;
    }
    
    .add-food-btn {
      background: #8fd19e;
      color: #121212;
      border: none;
      width: 40px;
      height: 40px;
      border-radius: 50%;
      font-size: 18px;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .add-food-btn:hover {
      background: #7bc08a;
      transform: scale(1.1);
    }
    
    .empty-state {
      text-align: center !important;
      color: #888;
      margin: 60px auto !important;
      font-size: 18px;
      background: #2a2a2a;
      border-radius: 15px;
      padding: 40px 20px;
      box-shadow: 0 4px 15px rgba(143, 209, 158, 0.1);
      border: 1px solid rgba(143, 209, 158, 0.2);
      max-width: 500px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      width: 100%;
      box-sizing: border-box;
    }
    
    .empty-state i {
      font-size: 80px;
      margin-bottom: 25px;
      color: #8fd19e;
    }
    
    .empty-state p {
      margin: 15px 0;
      line-height: 1.6;
    }
    
    @media (min-width: 768px) {
      .empty-state {
        margin: 40px auto !important;
        max-width: 500px;
        width: 100%;
        padding: 60px 40px;
      }
    }
    
    @media (max-width: 767px) {
      .empty-state {
        margin: 30px auto !important;
        padding: 30px 15px;
        font-size: 16px;
        max-width: 90%;
        width: 90%;
      }
      
      .empty-state i {
        font-size: 60px;
        margin-bottom: 20px;
      }
    }
    
    .action-buttons {
      display: flex;
      gap: 15px;
      margin: 20px auto;
      flex-wrap: wrap;
      max-width: 100%;
      width: 100%;
      box-sizing: border-box;
    }
    
    .action-btn {
      flex: 1;
      min-width: 120px;
      padding: 15px 20px;
      border: none;
      border-radius: 12px;
      font-size: 16px;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      min-height: 50px;
    }
    
    .btn-add-meal {
      background: #8fd19e;
      color: #121212;
    }
    
    .btn-add-meal:hover {
      background: #7bc08a;
      transform: translateY(-2px);
    }
    
    .btn-clear {
      background: #e74c3c;
      color: #fff;
    }
    
    .btn-clear:hover {
      background: #c0392b;
      transform: translateY(-2px);
    }
    
    /* Custom Modal Styles */
    .custom-modal {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.8);
      z-index: 1000;
      display: none;
      align-items: flex-start;
      justify-content: center;
      padding: 20px;
      overflow: hidden;
      padding-top: 5vh;
    }
    
    .alert-modal {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.8);
      z-index: 2000;
      display: none;
      align-items: center;
      justify-content: center;
      padding: 20px;
      overflow: hidden;
    }
    
    .custom-modal-content {
      background: #232323;
      border-radius: 20px;
      padding: 20px;
      max-width: 400px;
      width: 100%;
      text-align: center;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
      margin: 0;
      max-height: calc(90vh - 40px);
      overflow-y: auto;
      -webkit-overflow-scrolling: touch;
      position: relative;
    }
    
    .goal-form {
      text-align: left;
    }
    
    /* Responsive adjustments for smaller screens */
    @media (max-height: 700px) {
      .custom-modal {
        align-items: center;
        padding: 10px;
      }
      
      .custom-modal-content {
        margin: 0;
        max-height: calc(100vh - 20px);
        padding: 15px;
        max-width: 350px;
      }
      
      .modal-icon {
        font-size: 32px;
        margin-bottom: 10px;
      }
      
      .modal-title {
        font-size: 18px;
        margin-bottom: 15px;
      }
      
      .form-group {
        margin-bottom: 12px;
      }
      
      .form-group label {
        font-size: 12px;
        margin-bottom: 4px;
      }
      
      .form-group input {
        padding: 8px 12px;
        font-size: 13px;
      }
      
      .modal-buttons {
        margin-top: 15px;
        gap: 10px;
      }
      
      .modal-btn {
        padding: 8px 16px;
        font-size: 13px;
        min-width: 80px;
      }
    }
    
    /* Force scroll visibility for very small screens */
    @media (max-height: 600px) {
      .custom-modal {
        padding: 5px;
      }
      
      .custom-modal-content {
        margin: 0;
        max-height: calc(100vh - 10px);
        padding: 12px;
        max-width: 320px;
      }
      
      .modal-icon {
        font-size: 28px;
        margin-bottom: 8px;
      }
      
      .modal-title {
        font-size: 16px;
        margin-bottom: 12px;
      }
      
      .form-group {
        margin-bottom: 10px;
      }
      
      .form-group label {
        font-size: 11px;
        margin-bottom: 3px;
      }
      
      .form-group input {
        padding: 6px 10px;
        font-size: 12px;
      }
      
      .modal-buttons {
        margin-top: 12px;
        flex-direction: column;
        gap: 8px;
      }
      
      .modal-btn {
        width: 100%;
        padding: 8px 16px;
        font-size: 12px;
      }
    }
    
    .modal-icon {
      font-size: 40px;
      margin-bottom: 15px;
    }
    
    .modal-icon.edit {
      color: #8fd19e;
    }
    
    .modal-icon.success {
      color: #4CAF50;
    }
    
    .modal-icon.warning {
      color: #f39c12;
    }
    
    .modal-icon.error {
      color: #e74c3c;
    }
    
    .modal-icon.add {
      color: #8fd19e;
    }
    
    .modal-icon.edit {
      color: #64b5f6;
    }
    
    .success-modal {
      max-width: 350px;
      padding: 25px;
    }
    
    .add-meal-modal {
      max-width: 450px;
      padding: 20px;
      max-height: 75vh;
      overflow-y: auto;
      position: relative;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
      margin: 5% auto;
      
      /* Custom scrollbar */
      scrollbar-width: thin;
      scrollbar-color: #8fd19e #2a2a2a;
    }
    
    .add-meal-modal::-webkit-scrollbar {
      width: 8px;
    }
    
    .add-meal-modal::-webkit-scrollbar-track {
      background: #2a2a2a;
      border-radius: 4px;
    }
    
    .add-meal-modal::-webkit-scrollbar-thumb {
      background: #8fd19e;
      border-radius: 4px;
      border: 1px solid #2a2a2a;
    }
    
    .add-meal-modal::-webkit-scrollbar-thumb:hover {
      background: #7bc08a;
    }
    
    .meal-form {
      text-align: left;
    }
    
    .form-group select {
      width: 100%;
      padding: 10px 14px;
      background: #2a2a2a;
      border: 2px solid #444;
      border-radius: 8px;
      color: #fff;
      font-size: 14px;
      transition: all 0.3s ease;
    }
    
    .form-group select:focus {
      outline: none;
      border-color: #8fd19e;
      box-shadow: 0 0 0 3px rgba(143, 209, 158, 0.1);
    }
    
    .nutrition-preview {
      background: #2a2a2a;
      border-radius: 10px;
      padding: 15px;
      margin: 15px 0;
      border: 1px solid #444;
    }
    
    .nutrition-preview h4 {
      color: #8fd19e;
      font-size: 14px;
      margin-bottom: 10px;
      text-align: center;
    }
    
    .nutrition-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 8px;
    }
    
    .nutrition-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 5px 0;
    }
    
    .nutrition-label {
      color: #ccc;
      font-size: 12px;
    }
    
    .nutrition-value {
      color: #8fd19e;
      font-size: 12px;
      font-weight: bold;
    }
    
    .food-items-container {
      margin: 15px 0;
    }
    
    .food-item {
      background: #2a2a2a;
      border-radius: 10px;
      padding: 15px;
      margin-bottom: 15px;
      border: 1px solid #444;
    }
    
    .quantity-input-group {
      display: flex;
      gap: 10px;
      align-items: center;
    }
    
    .quantity-input-group .quantity-input {
      flex: 1;
    }
    
    .remove-food-btn {
      background: #e74c3c;
      color: #fff;
      border: none;
      border-radius: 8px;
      padding: 8px 12px;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    
    .remove-food-btn:hover {
      background: #c0392b;
      transform: translateY(-2px);
    }
    
    .add-food-btn-container {
      text-align: center;
      margin: 15px 0;
    }
    
    .add-food-btn {
      background: #8fd19e;
      color: #2a2a2a;
      border: none;
      border-radius: 50%;
      width: 40px;
      height: 40px;
      font-size: 18px;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 10px auto;
    }
    
    .add-food-btn:hover {
      background: #7bc08a;
      transform: scale(1.1);
      box-shadow: 0 4px 12px rgba(143, 209, 158, 0.4);
    }
    
    /* Media queries específicas para o modal de adicionar refeições */
    @media (max-height: 700px) {
      .add-meal-modal {
        max-width: 400px;
        padding: 15px;
        max-height: 70vh;
        margin: 3% auto;
      }
    }
    
    @media (max-height: 600px) {
      .add-meal-modal {
        max-width: 380px;
        padding: 12px;
        max-height: 65vh;
        margin: 2% auto;
      }
      
      .food-item {
        padding: 12px;
        margin-bottom: 10px;
      }
      
      .modal-buttons {
        flex-direction: column;
        gap: 8px;
        margin-top: 12px;
      }
      
      .modal-btn {
        padding: 8px 16px;
        font-size: 13px;
      }
      
      .add-food-btn {
        width: 35px;
        height: 35px;
        font-size: 16px;
      }
    }
    
    @media (max-height: 500px) {
      .add-meal-modal {
        max-height: 60vh;
        margin: 1% auto;
        padding: 10px;
      }
    }
    
    .modal-message {
      color: #ccc;
      font-size: 16px;
      margin-bottom: 25px;
      line-height: 1.5;
    }
    
    .modal-submessage {
      color: #999;
      font-size: 14px;
      margin-bottom: 20px;
      font-style: italic;
      line-height: 1.4;
    }
    
    .modal-title {
      color: #fff;
      font-size: 20px;
      font-weight: bold;
      margin-bottom: 20px;
    }
    
    .goal-form {
      text-align: left;
    }
    
    .form-group {
      margin-bottom: 15px;
    }
    
    .form-group label {
      display: block;
      color: #ccc;
      font-size: 13px;
      font-weight: 500;
      margin-bottom: 6px;
    }
    
    .form-group input {
      width: 100%;
      padding: 10px 14px;
      background: #2a2a2a;
      border: 2px solid #444;
      border-radius: 8px;
      color: #fff;
      font-size: 14px;
      transition: all 0.3s ease;
    }
    
    .form-group input:focus {
      outline: none;
      border-color: #8fd19e;
      box-shadow: 0 0 0 3px rgba(143, 209, 158, 0.1);
    }
    
    .modal-buttons {
      display: flex;
      gap: 12px;
      justify-content: center;
      margin-top: 20px;
    }
    
    .modal-btn {
      padding: 10px 20px;
      border-radius: 20px;
      font-size: 14px;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.3s ease;
      border: none;
      min-width: 100px;
    }
    
    .modal-btn.secondary {
      background: #555;
      color: #fff;
    }
    
    .modal-btn.secondary:hover {
      background: #666;
      transform: translateY(-2px);
    }
    
    .modal-btn.primary {
      background: #8fd19e;
      color: #2a2a2a;
    }
    
    .modal-btn.primary:hover {
      background: #7bc08a;
      transform: translateY(-2px);
      box-shadow: 0 4px 15px rgba(143, 209, 158, 0.4);
    }
    
    .modal-btn.danger {
      background: #e74c3c;
      color: #fff;
    }
    
    .modal-btn.danger:hover {
      background: #c0392b;
      transform: translateY(-2px);
      box-shadow: 0 4px 15px rgba(231, 76, 60, 0.4);
    }
    
    /* Remove spinners from number inputs */
    input[type="number"]::-webkit-outer-spin-button,
    input[type="number"]::-webkit-inner-spin-button {
      -webkit-appearance: none;
      margin: 0;
    }
    
    input[type="number"] {
      -moz-appearance: textfield;
    }
    
    input::-webkit-outer-spin-button,
    input::-webkit-inner-spin-button {
      -webkit-appearance: none;
      margin: 0;
    }
    
    input[type="number"] {
      -moz-appearance: textfield;
    }
  </style>
</head>
<body>
  <!-- Header -->
  <div class="diet-header">
      <div class="header-content">
        <div class="logo">Nutra</div>
        <div class="date-navigation">
          <button class="nav-arrow" onclick="changeDate(-1)">
            <i class="fas fa-chevron-left"></i>
          </button>
          <span class="current-date" id="currentDate">Hoje</span>
          <button class="nav-arrow" onclick="changeDate(1)">
            <i class="fas fa-chevron-right"></i>
          </button>
        </div>
      </div>
    </div>

  <div class="container" style="margin-top: 100px;">
    <!-- Daily Goal Card -->
    <div class="daily-goal-card">
      <div class="goal-header">
        <h3 class="goal-title">Meta diária: <span id="dailyGoal">{{ profile.daily_calories|default:2000 }}</span> kcal</h3>
        <button class="edit-goal-btn" onclick="openGoalModal()">
          <i class="fas fa-pencil-alt"></i> Editar
        </button>
      </div>
      
      <div class="calorie-summary">
        <div>
          <div class="calorie-consumed" id="caloriesConsumed">{{ total_calories_consumed|default:0 }}</div>
          <div class="calorie-consumed-label">Consumidas</div>
        </div>
        
        <div class="calorie-circle" id="calorieCircle" style="--progress-green: 0deg; --progress-total: 0deg;">
          <div class="calorie-content">
            <div class="calorie-remaining" id="caloriesRemaining">{{ profile.daily_calories|default:2000 }}</div>
            <div class="calorie-label">Restam</div>
          </div>
        </div>
      </div>
      
      <div class="macros-grid">
        <div class="macro-card" id="carbsCard">
          <div class="macro-progress-bar" id="carbsProgress"></div>
          <div class="macro-name">Carboidratos</div>
          <div class="macro-value" id="carbsConsumed">{{ total_carbs_consumed|default:0 }}g</div>
          <div class="macro-remaining">/ {{ profile.carbs_goal|default:250 }}g</div>
        </div>
        <div class="macro-card" id="proteinCard">
          <div class="macro-progress-bar" id="proteinProgress"></div>
          <div class="macro-name">Proteínas</div>
          <div class="macro-value" id="proteinConsumed">{{ total_protein_consumed|default:0 }}g</div>
          <div class="macro-remaining">/ {{ profile.protein_goal|default:150 }}g</div>
        </div>
        <div class="macro-card" id="fatCard">
          <div class="macro-progress-bar" id="fatProgress"></div>
          <div class="macro-name">Gorduras</div>
          <div class="macro-value" id="fatConsumed">{{ total_fat_consumed|default:0 }}g</div>
          <div class="macro-remaining">/ {{ profile.fat_goal|default:80 }}g</div>
        </div>
        <div class="macro-card" id="fiberCard">
          <div class="macro-progress-bar" id="fiberProgress"></div>
          <div class="macro-name">Fibras</div>
          <div class="macro-value" id="fiberConsumed">{{ total_fiber_consumed|default:0 }}g</div>
          <div class="macro-remaining">/{{ profile.fiber_goal|default:30 }}g</div>
        </div>
      </div>
    </div>

    <!-- Meals List -->
    {% if meals %}
      {% for meal in meals %}
        <div class="meal-card">
          <div class="meal-header">
            <h3 class="meal-name">{{ meal.name }}</h3>
            <div class="meal-actions">
              <span class="meal-calories">{{ meal.get_total_calories|floatformat:0 }} kcal</span>
              <div class="meal-buttons">
                <button class="edit-meal-btn" onclick="editMeal({{ meal.id }})" title="Editar refeição">
                  <i class="fas fa-edit"></i>
                </button>
                <button class="delete-meal-btn" onclick="deleteMeal({{ meal.id }})" title="Excluir refeição">
                  <i class="fas fa-trash"></i>
                </button>
              </div>
            </div>
          </div>
          
          <div class="meal-items">
            {% for item in meal.mealitem_set.all %}
              <div class="meal-item">
                <div class="item-info">
                  <span class="item-name">{{ item.food.name }}</span>
                  <span class="item-quantity">{{ item.quantity }}g</span>
                </div>
                <div class="item-nutrition">
                  <span class="nutrition-value">{{ item.get_calories|floatformat:0 }} kcal</span>
                  <span class="nutrition-details">{{ item.get_protein|floatformat:1 }}p / {{ item.get_carbs|floatformat:1 }}c / {{ item.get_fat|floatformat:1 }}g</span>
                </div>
              </div>
            {% endfor %}
          </div>
          
          <div class="meal-totals">
            <div class="total-item">
              <span class="total-label">Proteínas:</span>
              <span class="total-value">{{ meal.get_total_protein|floatformat:1 }}g</span>
            </div>
            <div class="total-item">
              <span class="total-label">Carboidratos:</span>
              <span class="total-value">{{ meal.get_total_carbs|floatformat:1 }}g</span>
            </div>
            <div class="total-item">
              <span class="total-label">Gorduras:</span>
              <span class="total-value">{{ meal.get_total_fat|floatformat:1 }}g</span>
            </div>
            <div class="total-item">
              <span class="total-label">Fibras:</span>
              <span class="total-value">{{ meal.get_total_fiber|floatformat:1 }}g</span>
            </div>
          </div>
        </div>
      {% endfor %}
    {% else %}
    <!-- Empty State for Meals -->
    <div class="empty-state">
      <i class="fas fa-utensils"></i>
      <p>Nenhuma refeição adicionada ainda.</p>
      <p>Clique em "Adicionar refeição" para começar!</p>
    </div>
    {% endif %}

    <!-- Action Buttons -->
    <div class="action-buttons">
      <button class="action-btn btn-add-meal" onclick="openAddMealModal()">
        <i class="fas fa-plus"></i> Adicionar refeição
      </button>
      <button class="action-btn btn-clear" onclick="clearDay()">
        <i class="fas fa-broom"></i> Limpar dia
      </button>
    </div>
  </div>

  <!-- Goal Edit Modal -->
  <div class="custom-modal" id="goalModal">
    <div class="custom-modal-content">
      <div class="modal-icon edit">
        <i class="fas fa-pencil-alt"></i>
      </div>
      <h3 class="modal-title">Editar Metas Diárias</h3>
      
      <form id="goalForm" class="goal-form">
        {% csrf_token %}
        <div class="form-group">
          <label for="dailyCalories">Calorias Diárias (kcal)</label>
          <input type="number" id="dailyCalories" name="daily_calories" 
                 value="{{ profile.daily_calories|default:2000 }}" 
                 min="1000" max="5000" required>
        </div>
        
        <div class="form-group">
          <label for="proteinGoal">Proteínas (g)</label>
          <input type="number" id="proteinGoal" name="protein_goal" 
                 value="{{ profile.protein_goal|default:150 }}" 
                 min="50" max="300" required>
        </div>
        
        <div class="form-group">
          <label for="carbsGoal">Carboidratos (g)</label>
          <input type="number" id="carbsGoal" name="carbs_goal" 
                 value="{{ profile.carbs_goal|default:250 }}" 
                 min="100" max="500" required>
        </div>
        
        <div class="form-group">
          <label for="fatGoal">Gorduras (g)</label>
          <input type="number" id="fatGoal" name="fat_goal" 
                 value="{{ profile.fat_goal|default:67 }}" 
                 min="30" max="150" required>
        </div>
        
        <div class="form-group">
          <label for="fiberGoal">Fibras (g)</label>
          <input type="number" id="fiberGoal" name="fiber_goal" 
                 value="{{ profile.fiber_goal|default:30 }}" 
                 min="10" max="100" required>
        </div>
        
        <div class="modal-buttons">
          <button type="button" class="modal-btn secondary" onclick="closeGoalModal()">Cancelar</button>
          <button type="submit" class="modal-btn primary">Salvar Metas</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Meal Success Modal -->
  <div class="alert-modal" id="mealSuccessModal">
    <div class="custom-modal-content success-modal">
      <div class="modal-icon success">
        <i class="fas fa-check-circle"></i>
      </div>
      <h3 class="modal-title">Sucesso!</h3>
      <p class="modal-message">Refeição adicionada com sucesso!</p>
      <div class="modal-buttons">
        <button class="modal-btn primary" onclick="closeMealSuccessModal()">OK</button>
      </div>
    </div>
  </div>

  <!-- Error Modal -->
  <div class="alert-modal" id="errorModal">
    <div class="custom-modal-content">
      <div class="modal-icon error">
        <i class="fas fa-exclamation-triangle"></i>
      </div>
      <h3 class="modal-title">Erro</h3>
      <p class="modal-message" id="errorMessage">Ocorreu um erro inesperado.</p>
      <div class="modal-buttons">
        <button class="modal-btn primary" onclick="closeErrorModal()">OK</button>
      </div>
    </div>
  </div>

  <!-- Clear Day Confirmation Modal -->
  <div class="alert-modal" id="clearDayModal">
    <div class="custom-modal-content">
      <div class="modal-icon warning">
        <i class="fas fa-broom"></i>
      </div>
      <h3 class="modal-title">Limpar Dia</h3>
      <p class="modal-message">Tem certeza que deseja limpar todos os dados do dia?</p>
      <p class="modal-submessage">Esta ação não pode ser desfeita.</p>
      <div class="modal-buttons">
        <button class="modal-btn secondary" onclick="closeClearDayModal()">Cancelar</button>
        <button class="modal-btn danger" onclick="confirmClearDay()">Limpar Dia</button>
      </div>
    </div>
  </div>

  <!-- Delete Confirmation Modal -->
  <div class="alert-modal" id="deleteConfirmModal">
    <div class="custom-modal-content">
      <div class="modal-icon error">
        <i class="fas fa-exclamation-triangle"></i>
      </div>
      <h3 class="modal-title">Confirmar Exclusão</h3>
      <p class="modal-message" id="deleteConfirmMessage">Tem certeza que deseja excluir esta refeição?</p>
      <div class="modal-buttons">
        <button class="modal-btn secondary" onclick="closeDeleteConfirmModal()">Cancelar</button>
        <button class="modal-btn danger" onclick="confirmDeleteMeal()">Excluir</button>
      </div>
    </div>
  </div>
  <div class="custom-modal" id="addMealModal">
    <div class="custom-modal-content add-meal-modal">
      <div class="modal-icon add">
        <i class="fas fa-plus"></i>
      </div>
      <h3 class="modal-title">Adicionar Refeição</h3>
      
      <form id="mealForm" class="meal-form" onsubmit="return false;">
        {% csrf_token %}
        <div class="form-group">
          <label for="mealName">Nome da Refeição</label>
          <input type="text" id="mealName" name="meal_name" 
                 placeholder="Ex: Almoço, Jantar, Lanche..." required>
        </div>
        
        <div class="food-items-container" id="foodItemsContainer">
          <div class="food-item" data-item-index="0">
            <div class="form-group">
              <label for="foodSelect0">Alimento</label>
                      <select class="food-select" required>
                <option value="">Selecione um alimento</option>
                <option value="arroz_branco" data-calories="130" data-protein="2.5" data-carbs="28" data-fat="0.3" data-fiber="0.4">Arroz branco cozido</option>
                <option value="feijao_carioca" data-calories="77" data-protein="4.8" data-carbs="14" data-fat="0.5" data-fiber="8.5">Feijão carioca cozido</option>
                <option value="peito_frango" data-calories="165" data-protein="31" data-carbs="0" data-fat="3.6" data-fiber="0">Peito de frango grelhado</option>
                <option value="ovo_cozido" data-calories="155" data-protein="13" data-carbs="1.1" data-fat="11" data-fiber="0">Ovo cozido</option>
                <option value="batata_doce" data-calories="86" data-protein="1.6" data-carbs="20" data-fat="0.1" data-fiber="2.7">Batata doce cozida</option>
                <option value="banana_prata" data-calories="89" data-protein="1.1" data-carbs="23" data-fat="0.3" data-fiber="2.6">Banana prata</option>
                <option value="maca" data-calories="52" data-protein="0.3" data-carbs="14" data-fat="0.2" data-fiber="2.4">Maçã</option>
                <option value="brocolis" data-calories="35" data-protein="2.4" data-carbs="7" data-fat="0.4" data-fiber="3.3">Brócolis cozido</option>
                <option value="aveia_flocos" data-calories="389" data-protein="16.9" data-carbs="66" data-fat="6.9" data-fiber="8">Aveia em flocos</option>
                <option value="pao_frances" data-calories="270" data-protein="9" data-carbs="57" data-fat="3.4" data-fiber="2.3">Pão francês</option>
                <option value="queijo_mussarela" data-calories="280" data-protein="19" data-carbs="3" data-fat="21" data-fiber="0">Queijo mussarela</option>
                <option value="leite_integral" data-calories="61" data-protein="3.2" data-carbs="4.8" data-fat="3.2" data-fiber="0">Leite integral</option>
                <option value="iogurte_natural" data-calories="63" data-protein="3.5" data-carbs="4.7" data-fat="3.3" data-fiber="0">Iogurte natural</option>
                <option value="amendoas" data-calories="576" data-protein="21" data-carbs="22" data-fat="49" data-fiber="12.5">Amêndoas</option>
                <option value="castanha_para" data-calories="656" data-protein="14" data-carbs="12" data-fat="66" data-fiber="8.5">Castanha-do-pará</option>
                <option value="salmao_grelhado" data-calories="208" data-protein="20" data-carbs="0" data-fat="13" data-fiber="0">Salmão grelhado</option>
                <option value="carne_bovina" data-calories="250" data-protein="26" data-carbs="0" data-fat="15" data-fiber="0">Carne bovina (patinho)</option>
                <option value="quinoa_cozida" data-calories="120" data-protein="4.1" data-carbs="21" data-fat="1.9" data-fiber="2.8">Quinoa cozida</option>
                <option value="lentilha_cozida" data-calories="116" data-protein="9" data-carbs="20" data-fat="0.4" data-fiber="7.9">Lentilha cozida</option>
                <option value="abacate" data-calories="160" data-protein="2" data-carbs="8.5" data-fat="14.7" data-fiber="6.7">Abacate</option>
              </select>
            </div>
            
            <div class="form-group">
              <label for="quantity0">Quantidade (gramas)</label>
              <div class="quantity-input-group">
                        <input type="number" class="quantity-input" 
                       min="1" max="2000" value="100" required>
                <button type="button" class="remove-food-btn" onclick="removeFoodItem(0)" style="display: none;">
                  <i class="fas fa-trash"></i>
                </button>
              </div>
            </div>
          </div>
        </div>
        
        <div class="add-food-btn-container">
          <button type="button" class="add-food-btn" onclick="addFoodItem()" title="Adicionar outro alimento">
            +
          </button>
        </div>
        
        <div class="nutrition-preview" id="nutritionPreview" style="display: none;">
          <h4>Total da Refeição:</h4>
          <div class="nutrition-grid">
            <div class="nutrition-item">
              <span class="nutrition-label">Calorias:</span>
              <span class="nutrition-value" id="previewCalories">0</span>
            </div>
            <div class="nutrition-item">
              <span class="nutrition-label">Proteínas:</span>
              <span class="nutrition-value" id="previewProtein">0g</span>
            </div>
            <div class="nutrition-item">
              <span class="nutrition-label">Carboidratos:</span>
              <span class="nutrition-value" id="previewCarbs">0g</span>
            </div>
            <div class="nutrition-item">
              <span class="nutrition-label">Gorduras:</span>
              <span class="nutrition-value" id="previewFat">0g</span>
            </div>
            <div class="nutrition-item">
              <span class="nutrition-label">Fibras:</span>
              <span class="nutrition-value" id="previewFiber">0g</span>
            </div>
          </div>
        </div>
        
        <div class="modal-buttons">
          <button type="button" class="modal-btn secondary" onclick="closeAddMealModal()">Cancelar</button>
          <button type="button" class="modal-btn primary" onclick="addMeal()">Adicionar Refeição</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Modal de Editar Refeição -->
  <div class="custom-modal" id="editMealModal">
    <div class="custom-modal-content add-meal-modal">
      <div class="modal-icon edit">
        <i class="fas fa-edit"></i>
      </div>
      <h3 class="modal-title">Editar Refeição</h3>
      
      <form id="editMealForm" class="meal-form" onsubmit="return false;">
        {% csrf_token %}
        <div class="form-group">
          <label for="editMealName">Nome da Refeição</label>
          <input type="text" id="editMealName" name="meal_name" 
                 placeholder="Ex: Almoço, Jantar, Lanche..." required>
        </div>
        
        <div class="food-items-container" id="editFoodItemsContainer">
          <!-- Itens de alimento serão adicionados aqui dinamicamente -->
        </div>
        
        <button type="button" class="add-food-btn" onclick="addFoodItemToEdit()">
          <i class="fas fa-plus"></i>
        </button>
        
        <div id="editNutritionPreview" class="nutrition-preview" style="display: none;">
          <h3>Preview Nutricional</h3>
          <div class="nutrition-summary">
            <div class="nutrition-item">
              <span class="nutrition-label">Calorias:</span>
              <span class="nutrition-value" id="editPreviewCalories">0</span>
            </div>
            <div class="nutrition-item">
              <span class="nutrition-label">Proteínas:</span>
              <span class="nutrition-value" id="editPreviewProtein">0g</span>
            </div>
            <div class="nutrition-item">
              <span class="nutrition-label">Carboidratos:</span>
              <span class="nutrition-value" id="editPreviewCarbs">0g</span>
            </div>
            <div class="nutrition-item">
              <span class="nutrition-label">Gorduras:</span>
              <span class="nutrition-value" id="editPreviewFat">0g</span>
            </div>
            <div class="nutrition-item">
              <span class="nutrition-label">Fibras:</span>
              <span class="nutrition-value" id="editPreviewFiber">0g</span>
            </div>
          </div>
        </div>
        
        <!-- Seção de alimentos adicionados -->
        <div id="editMealItems" class="meal-items" style="display: none;">
          <h4>Alimentos Adicionados:</h4>
          <div id="editMealItemsList">
            <!-- Alimentos serão adicionados aqui dinamicamente -->
          </div>
        </div>
        
        <div class="modal-buttons">
          <button type="button" class="modal-btn secondary" onclick="closeEditMealModal()">Cancelar</button>
          <button type="button" class="modal-btn primary" onclick="saveEditedMeal()">Salvar Alterações</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Footer -->
  <footer>
    <nav>
      <a href="{% url 'treino' %}"><i class="fas fa-dumbbell"></i> Treinos</a>
      <a href="#" class="active"><i class="fas fa-utensils"></i> Dieta</a>
      <a href="{% url 'perfil' %}"><i class="fas fa-user"></i> Perfil</a>
    </nav>
  </footer>

  <script>
    // Global variables
    let currentDate = new Date();
    
    // Initialize page
    document.addEventListener('DOMContentLoaded', function() {
      console.log('Página carregada, inicializando...');
      
      // Aguardar um pouco para garantir que o DOM esteja pronto
      setTimeout(() => {
        // Verificar se elementos existem
        console.log('Elementos encontrados:', {
          calorieCircle: !!document.getElementById('calorieCircle'),
          caloriesConsumed: !!document.getElementById('caloriesConsumed'),
          dailyGoal: !!document.getElementById('dailyGoal'),
          carbsCard: !!document.getElementById('carbsCard'),
          carbsProgress: !!document.getElementById('carbsProgress'),
          carbsConsumed: !!document.getElementById('carbsConsumed')
        });
        
      updateDateDisplay();
      updateProgressCircle();
        updateMacroProgress();
        
        // Adicionar função de teste ao window para debug
        window.testProgress = testProgress;
        console.log('Função testProgress() disponível para teste');
      }, 100);
      
      // Event listener para o formulário de metas
      const goalForm = document.getElementById('goalForm');
      if (goalForm) {
        goalForm.addEventListener('submit', function(e) {
          e.preventDefault();
          saveGoals();
        });
      }
      
      // Event listener para fechar modal ao clicar fora
      const goalModal = document.getElementById('goalModal');
      if (goalModal) {
        goalModal.addEventListener('click', function(e) {
          if (e.target === this) {
            closeGoalModal();
          }
        });
      }
      
      // Event listener para fechar modal de sucesso ao clicar fora
      const mealSuccessModal = document.getElementById('mealSuccessModal');
      if (mealSuccessModal) {
        mealSuccessModal.addEventListener('click', function(e) {
          if (e.target === this) {
            closeMealSuccessModal();
          }
        });
      }
      
      // Event listener para fechar modal de adicionar refeição ao clicar fora
      const addMealModal = document.getElementById('addMealModal');
      if (addMealModal) {
        addMealModal.addEventListener('click', function(e) {
          if (e.target === this) {
            closeAddMealModal();
          }
        });
      }
      
      // Event listener para fechar modal de editar refeição ao clicar fora
      const editModal = document.getElementById('editMealModal');
      if (editModal && !editModal.hasAttribute('data-listener-added')) {
        editModal.addEventListener('click', function(e) {
          if (e.target === this) {
            closeEditMealModal();
          }
        });
        editModal.setAttribute('data-listener-added', 'true');
      }
      
      // Event listener para fechar modal de confirmação de exclusão ao clicar fora
      const deleteConfirmModal = document.getElementById('deleteConfirmModal');
      if (deleteConfirmModal) {
        deleteConfirmModal.addEventListener('click', function(e) {
          if (e.target === this) {
            closeDeleteConfirmModal();
          }
        });
      }
      
      // Event listener para fechar modal de limpar dia ao clicar fora
      const clearDayModal = document.getElementById('clearDayModal');
      if (clearDayModal) {
        clearDayModal.addEventListener('click', function(e) {
          if (e.target === this) {
            closeClearDayModal();
          }
        });
      }
      
      // Event listeners para atualizar preview nutricional
      // Removido - será adicionado dinamicamente para cada item
      
      // Event listener para o formulário de refeição (removido - usando onclick no botão)
    });
    
    // Date navigation
    function changeDate(days) {
      currentDate.setDate(currentDate.getDate() + days);
      updateDateDisplay();
    }
    
    function updateDateDisplay() {
      const today = new Date();
      const dateStr = currentDate.toLocaleDateString('pt-BR');
      
      if (currentDate.toDateString() === today.toDateString()) {
        document.getElementById('currentDate').textContent = 'Hoje';
      } else {
        document.getElementById('currentDate').textContent = dateStr;
      }
    }
    
    function updateProgressCircle() {
      console.log('=== UPDATE PROGRESS CIRCLE ===');
      
      const consumedElement = document.getElementById('caloriesConsumed');
      const goalElement = document.getElementById('dailyGoal');
      const remainingElement = document.getElementById('caloriesRemaining');
      const circleElement = document.getElementById('calorieCircle');
      
      if (!consumedElement || !goalElement || !remainingElement || !circleElement) {
        console.error('Elementos não encontrados para updateProgressCircle');
        return;
      }
      
      const consumed = parseInt(consumedElement.textContent) || 0;
      const goal = parseInt(goalElement.textContent) || 2000;
      const remaining = Math.max(0, goal - consumed);
      const exceeded = Math.max(0, consumed - goal);
      
      // Atualizar texto baseado se ultrapassou ou não
      if (exceeded > 0) {
        remainingElement.textContent = `+${exceeded}`;
        remainingElement.style.color = '#e74c3c'; // Vermelho para ultrapassagem
      } else {
        remainingElement.textContent = remaining;
        remainingElement.style.color = '#8fd19e'; // Verde para dentro da meta
      }
      
      // Verificar se ultrapassou a meta
      const hasExceeded = consumed > goal;
      
      // Calcular progresso
      const progressDegrees = Math.min(360, (consumed / goal) * 360);
      
      // Aplicar progresso ao círculo
      circleElement.style.setProperty('--progress-green', `${progressDegrees}deg`);
      circleElement.style.setProperty('--progress-total', `${progressDegrees}deg`);
      
      // Aplicar classe de ultrapassagem se necessário
      if (hasExceeded) {
        circleElement.classList.add('exceeded');
        console.log(`⚠️ META ULTRAPASSADA: ${consumed}/${goal} kcal (+${exceeded} kcal)`);
      } else {
        circleElement.classList.remove('exceeded');
        console.log(`✅ Meta dentro do limite: ${consumed}/${goal} kcal (${remaining} restam)`);
      }
      
      console.log(`Progresso atualizado: ${consumed}/${goal} kcal (${progressDegrees}deg)`);
    }
    
    function updateMacroProgress() {
      // Carboidratos
      updateMacroCard('carbs', '{{ profile.carbs_goal|default:250 }}');
      
      // Proteínas
      updateMacroCard('protein', '{{ profile.protein_goal|default:150 }}');
      
      // Gorduras
      updateMacroCard('fat', '{{ profile.fat_goal|default:80 }}');
      
      // Fibras
      updateMacroCard('fiber', '{{ profile.fiber_goal|default:30 }}');
    }
    
    function updateMacroCard(macroType, goalValue) {
      console.log(`=== UPDATE MACRO CARD: ${macroType} ===`);
      
      const consumedElement = document.getElementById(`${macroType}Consumed`);
      const progressElement = document.getElementById(`${macroType}Progress`);
      const cardElement = document.getElementById(`${macroType}Card`);
      
      if (!consumedElement || !progressElement || !cardElement) {
        console.error(`Elementos não encontrados para ${macroType}`);
        return;
      }
      
      const consumed = parseFloat(consumedElement.textContent) || 0;
      const goal = parseFloat(goalValue) || 100;
      const percentage = Math.min(100, (consumed / goal) * 100);
      
      // Atualizar largura da barra de progresso
      progressElement.style.width = `${percentage}%`;
      
      // Verificar se ultrapassou a meta
      if (consumed > goal) {
        cardElement.classList.add('exceeded');
        progressElement.classList.add('exceeded');
      } else {
        cardElement.classList.remove('exceeded');
        progressElement.classList.remove('exceeded');
      }
      
      console.log(`${macroType}: ${consumed}/${goal}g (${percentage.toFixed(1)}%)`);
    }
    
    function openGoalModal() {
      const modal = document.getElementById('goalModal');
      const body = document.body;
      
      // Prevenir scroll da página de fundo
      body.style.overflow = 'hidden';
      
      modal.style.display = 'flex';
      
      // Garantir que o modal seja scrollável
      const modalContent = modal.querySelector('.custom-modal-content');
      if (modalContent) {
        modalContent.scrollTop = 0;
      }
    }
    
    function closeGoalModal() {
      const modal = document.getElementById('goalModal');
      const body = document.body;
      
      // Restaurar scroll da página
      body.style.overflow = 'auto';
      
      modal.style.display = 'none';
    }
    
    function showSuccessModal() {
      const modal = document.getElementById('successModal');
      const body = document.body;
      
      // Prevenir scroll da página de fundo
      body.style.overflow = 'hidden';
      
      modal.style.display = 'flex';
      
      // Auto-fechar após 3 segundos
      setTimeout(() => {
        closeSuccessModal();
      }, 3000);
    }
    
    function showGoalsSuccessModal() {
      const modal = document.getElementById('mealSuccessModal');
      const body = document.body;
      
      // Prevenir scroll da página de fundo
      body.style.overflow = 'hidden';
      
      // Atualizar mensagem
      const title = modal.querySelector('.modal-title');
      const message = modal.querySelector('.modal-message');
      
      title.textContent = 'Metas Atualizadas!';
      message.textContent = 'Suas metas diárias foram salvas com sucesso!';
      
      modal.style.display = 'flex';
      
      // Auto-fechar após 3 segundos
      setTimeout(() => {
        closeMealSuccessModal();
      }, 3000);
    }
    
    function closeSuccessModal() {
      const modal = document.getElementById('successModal');
      const body = document.body;
      
      // Restaurar scroll da página
      body.style.overflow = 'auto';
      
      modal.style.display = 'none';
    }
    
    function showMealSuccessModal(message = 'Refeição adicionada com sucesso!') {
      const modal = document.getElementById('mealSuccessModal');
      const messageElement = modal.querySelector('.modal-message');
      const body = document.body;
      
      // Definir mensagem personalizada
      messageElement.textContent = message;
      
      // Prevenir scroll da página de fundo
      body.style.overflow = 'hidden';
      
      modal.style.display = 'flex';
      
      // REMOVIDO: Auto-fechar após 2 segundos
      // O modal agora só fecha quando o usuário clicar em "OK"
    }
    
    function closeMealSuccessModal() {
      const modal = document.getElementById('mealSuccessModal');
      const body = document.body;
      
      // Restaurar scroll da página
      body.style.overflow = 'auto';
      
      modal.style.display = 'none';
      
      // Recarregar página se necessário
      if (window.shouldReloadPage) {
        window.shouldReloadPage = false;
        location.reload();
      }
    }
    
    function showErrorModal(message) {
      const modal = document.getElementById('errorModal');
      const body = document.body;
      const messageElement = document.getElementById('errorMessage');
      
      // Definir mensagem de erro
      messageElement.textContent = message;
      
      // Prevenir scroll da página de fundo
      body.style.overflow = 'hidden';
      
      modal.style.display = 'flex';
    }
    
    function closeErrorModal() {
      const modal = document.getElementById('errorModal');
      const body = document.body;
      
      // Restaurar scroll da página
      body.style.overflow = 'auto';
      
      modal.style.display = 'none';
    }
    
    function closeAddMealModal() {
      console.log('DEBUG: Fechando modal de adicionar refeição');
      
      const modal = document.getElementById('addMealModal');
      const body = document.body;
      
      // Restaurar scroll da página
      body.style.overflow = 'auto';
      
      modal.style.display = 'none';
    }
    
    function closeEditMealModal() {
      console.log('DEBUG: Fechando modal de editar refeição');
      
      const modal = document.getElementById('editMealModal');
      const body = document.body;
      
      if (!modal) {
        console.error('Modal de edição não encontrado!');
        return;
      }
      
      // Restaurar scroll da página
      body.style.overflow = 'auto';
      
      modal.style.display = 'none';
      
      // Limpar variáveis globais
      window.currentMealToEdit = null;
      
      console.log('DEBUG: Modal de edição fechado com sucesso');
    }
    
    function updateNutritionPreview() {
      const container = document.getElementById('foodItemsContainer');
      const items = container.querySelectorAll('.food-item');
      
      let totalCalories = 0;
      let totalProtein = 0;
      let totalCarbs = 0;
      let totalFat = 0;
      let totalFiber = 0;
      
      items.forEach(item => {
        const foodSelect = item.querySelector('.food-select');
        const quantityInput = item.querySelector('.quantity-input');
        
        if (foodSelect.value && quantityInput.value) {
          const selectedOption = foodSelect.options[foodSelect.selectedIndex];
          const calories = parseFloat(selectedOption.dataset.calories) || 0;
          const protein = parseFloat(selectedOption.dataset.protein) || 0;
          const carbs = parseFloat(selectedOption.dataset.carbs) || 0;
          const fat = parseFloat(selectedOption.dataset.fat) || 0;
          const fiber = parseFloat(selectedOption.dataset.fiber) || 0;
          
          const quantity = parseFloat(quantityInput.value) || 0;
          const multiplier = quantity / 100; // Valores são por 100g
          
          totalCalories += calories * multiplier;
          totalProtein += protein * multiplier;
          totalCarbs += carbs * multiplier;
          totalFat += fat * multiplier;
          totalFiber += fiber * multiplier;
        }
      });
      
      // Atualizar preview
      document.getElementById('previewCalories').textContent = Math.round(totalCalories);
      document.getElementById('previewProtein').textContent = totalProtein.toFixed(1) + 'g';
      document.getElementById('previewCarbs').textContent = totalCarbs.toFixed(1) + 'g';
      document.getElementById('previewFat').textContent = totalFat.toFixed(1) + 'g';
      document.getElementById('previewFiber').textContent = totalFiber.toFixed(1) + 'g';
      
      // Mostrar preview se há pelo menos um alimento selecionado
      const preview = document.getElementById('nutritionPreview');
      if (totalCalories > 0) {
        preview.style.display = 'block';
      } else {
        preview.style.display = 'none';
      }
    }
    
    function updateEditNutritionPreview() {
      const container = document.getElementById('editFoodItemsContainer');
      const items = container.querySelectorAll('.food-item');
      
      let totalCalories = 0;
      let totalProtein = 0;
      let totalCarbs = 0;
      let totalFat = 0;
      let totalFiber = 0;
      
      items.forEach(item => {
        const foodSelect = item.querySelector('.food-select');
        const quantityInput = item.querySelector('.quantity-input');
        
        if (foodSelect && foodSelect.value && quantityInput && quantityInput.value) {
          // CORRIGIDO: Acessar dados nutricionais da opção selecionada
          const selectedOption = foodSelect.selectedOptions[0];
          const calories = parseFloat(selectedOption.dataset.calories) || 0;
          const protein = parseFloat(selectedOption.dataset.protein) || 0;
          const carbs = parseFloat(selectedOption.dataset.carbs) || 0;
          const fat = parseFloat(selectedOption.dataset.fat) || 0;
          const fiber = parseFloat(selectedOption.dataset.fiber) || 0;
          const quantity = parseFloat(quantityInput.value) || 0;
          
          totalCalories += (calories * quantity) / 100;
          totalProtein += (protein * quantity) / 100;
          totalCarbs += (carbs * quantity) / 100;
          totalFat += (fat * quantity) / 100;
          totalFiber += (fiber * quantity) / 100;
        }
      });
      
      // Atualizar elementos do preview
      document.getElementById('editPreviewCalories').textContent = Math.round(totalCalories);
      document.getElementById('editPreviewProtein').textContent = Math.round(totalProtein) + 'g';
      document.getElementById('editPreviewCarbs').textContent = Math.round(totalCarbs) + 'g';
      document.getElementById('editPreviewFat').textContent = Math.round(totalFat) + 'g';
      document.getElementById('editPreviewFiber').textContent = Math.round(totalFiber) + 'g';
      
      // Mostrar preview se houver pelo menos um alimento
      const preview = document.getElementById('editNutritionPreview');
      if (totalCalories > 0) {
        preview.style.display = 'block';
      } else {
        preview.style.display = 'none';
      }
      
      // Atualizar lista de alimentos adicionados
      updateEditMealItemsList();
    }
    
    function updateEditMealItemsList() {
      const container = document.getElementById('editFoodItemsContainer');
      const items = container.querySelectorAll('.food-item');
      const mealItemsContainer = document.getElementById('editMealItems');
      const mealItemsList = document.getElementById('editMealItemsList');
      
      // Limpar lista
      mealItemsList.innerHTML = '';
      
      let hasValidItems = false;
      
      items.forEach((item, index) => {
        const foodSelect = item.querySelector('.food-select');
        const quantityInput = item.querySelector('.quantity-input');
        
        if (foodSelect && foodSelect.value && quantityInput && quantityInput.value) {
          hasValidItems = true;
          
          const foodName = foodSelect.options[foodSelect.selectedIndex].text;
          const quantity = parseFloat(quantityInput.value);
          
          // CORRIGIDO: Acessar dados nutricionais da opção selecionada
          const selectedOption = foodSelect.selectedOptions[0];
          const calories = parseFloat(selectedOption.dataset.calories) || 0;
          const protein = parseFloat(selectedOption.dataset.protein) || 0;
          const carbs = parseFloat(selectedOption.dataset.carbs) || 0;
          const fat = parseFloat(selectedOption.dataset.fat) || 0;
          
          // Debug: verificar dados nutricionais
          console.log(`DEBUG: Alimento ${index} - Dados nutricionais:`, {
            foodName: foodName,
            quantity: quantity,
            selectedOption: selectedOption,
            calories: selectedOption.dataset.calories,
            protein: selectedOption.dataset.protein,
            carbs: selectedOption.dataset.carbs,
            fat: selectedOption.dataset.fat
          });
          
          console.log(`DEBUG: Alimento ${index} - Valores calculados:`, {
            calories: calories,
            protein: protein,
            carbs: carbs,
            fat: fat,
            caloriesTotal: Math.round(calories * quantity / 100),
            proteinTotal: Math.round(protein * quantity / 100),
            carbsTotal: Math.round(carbs * quantity / 100),
            fatTotal: Math.round(fat * quantity / 100)
          });
          
          const mealItem = document.createElement('div');
          mealItem.className = 'meal-item';
          mealItem.innerHTML = `
            <div class="item-info">
              <span class="item-name">${foodName}</span>
              <span class="item-quantity">${quantity}g</span>
            </div>
            <div class="item-nutrition">
              <span class="nutrition-value">${Math.round(calories * quantity / 100)} kcal</span>
              <span class="nutrition-details">${Math.round(protein * quantity / 100)}p / ${Math.round(carbs * quantity / 100)}c / ${Math.round(fat * quantity / 100)}g</span>
            </div>
          `;
          mealItemsList.appendChild(mealItem);
        }
      });
      
      // Mostrar/ocultar seção de alimentos
      if (hasValidItems) {
        mealItemsContainer.style.display = 'block';
      } else {
        mealItemsContainer.style.display = 'none';
      }
    }
    
    function addMeal() {
      console.log('=== ADICIONANDO REFEIÇÃO ===');
      
      const form = document.getElementById('mealForm');
      const formData = new FormData(form);
      
      // Validar nome da refeição
      const mealName = document.getElementById('mealName').value.trim();
      if (!mealName) {
        showErrorModal('Por favor, digite um nome para a refeição.');
        return;
      }
      
      // Coletar todos os alimentos
      const container = document.getElementById('foodItemsContainer');
      const items = container.querySelectorAll('.food-item');
      const foods = [];
      
      items.forEach(item => {
        const foodSelect = item.querySelector('.food-select');
        const quantityInput = item.querySelector('.quantity-input');
        
        if (foodSelect.value && quantityInput.value) {
          foods.push({
            food_id: foodSelect.value,
            quantity: parseFloat(quantityInput.value)
          });
        }
      });
      
      if (foods.length === 0) {
        console.log('DEBUG: Refeição sem alimentos - permitindo');
        // Permitir refeições sem alimentos
      }
      
      // Adicionar data atual (usar data local para evitar problemas de timezone)
      const today = new Date();
      const year = today.getFullYear();
      const month = String(today.getMonth() + 1).padStart(2, '0');
      const day = String(today.getDate()).padStart(2, '0');
      const dateString = `${year}-${month}-${day}`;
      
      formData.append('date', dateString);
      formData.append('foods', JSON.stringify(foods));
      
      console.log('Dados coletados:', {
        meal_name: formData.get('meal_name'),
        foods: foods,
        date: dateString,
        originalDate: today.toISOString()
      });
      
      // Mostrar loading
      const submitBtn = document.querySelector('#mealForm button[onclick="addMeal()"]');
      const originalText = submitBtn.textContent;
      submitBtn.textContent = 'Salvando...';
      submitBtn.disabled = true;
      
      // Enviar dados para o servidor
      fetch('{% url "add_meal" %}', {
        method: 'POST',
        body: formData,
        headers: {
          'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value
        }
      })
      .then(response => {
        console.log('Resposta recebida:', response.status);
        if (!response.ok) {
          throw new Error(`HTTP error! status: ${response.status}`);
        }
        return response.json();
      })
      .then(data => {
        console.log('Dados recebidos:', data);
        if (data.success) {
          // Fechar modal
          closeAddMealModal();
          
          // Mostrar modal de sucesso personalizado
          showMealSuccessModal();
          
          // Definir flag para recarregar a página após fechar o modal de sucesso
          window.shouldReloadPage = true;
        } else {
          showErrorModal('Erro ao adicionar refeição: ' + data.error);
        }
      })
      .catch(error => {
        console.error('Erro:', error);
        showErrorModal('Erro ao adicionar refeição. Verifique sua conexão e tente novamente.');
      })
      .finally(() => {
        // Restaurar botão
        submitBtn.textContent = originalText;
        submitBtn.disabled = false;
      });
      
      return false; // Prevenir submissão do formulário
    }
    
    function saveGoals() {
      const form = document.getElementById('goalForm');
      const formData = new FormData(form);
      
      // Enviar dados para o servidor
      fetch('{% url "update_goals" %}', {
        method: 'POST',
        body: formData,
        headers: {
          'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value
        }
      })
      .then(response => response.json())
      .then(data => {
        if (data.success) {
          // Atualizar valores na página
          document.getElementById('dailyGoal').textContent = data.daily_calories;
          document.getElementById('caloriesRemaining').textContent = data.daily_calories;
          
          // Atualizar metas de macronutrientes
          const carbsRemaining = document.querySelector('.macro-card:nth-child(1) .macro-remaining');
          const proteinRemaining = document.querySelector('.macro-card:nth-child(2) .macro-remaining');
          const fatRemaining = document.querySelector('.macro-card:nth-child(3) .macro-remaining');
          const fiberRemaining = document.querySelector('.macro-card:nth-child(4) .macro-remaining');
          
          carbsRemaining.textContent = `/ ${data.carbs_goal}g`;
          proteinRemaining.textContent = `/ ${data.protein_goal}g`;
          fatRemaining.textContent = `/ ${data.fat_goal}g`;
          fiberRemaining.textContent = `/ ${data.fiber_goal}g`;
          
          // Atualizar círculo de progresso e barras de macronutrientes
          updateProgressCircle();
          updateMacroProgress();
          
          // Fechar modal
          closeGoalModal();
          
          // Mostrar modal de sucesso personalizado
          showGoalsSuccessModal();
        } else {
          console.error('Erro ao salvar metas:', data.error);
          showErrorModal('Erro ao salvar metas: ' + data.error);
        }
      })
      .catch(error => {
        console.error('Erro:', error);
        showErrorModal('Erro de conexão. Tente novamente.');
      });
    }
    
    function openAddMealModal() {
      const modal = document.getElementById('addMealModal');
      const body = document.body;
      const modalTitle = modal.querySelector('.modal-title');
      const submitBtn = modal.querySelector('button[onclick="addMeal()"]');
      
      // Resetar para modo de adição
      modalTitle.textContent = 'Adicionar Refeição';
      submitBtn.textContent = 'Adicionar Refeição';
      submitBtn.setAttribute('onclick', 'addMeal()');
      
      // Prevenir scroll da página de fundo
      body.style.overflow = 'hidden';
      
      modal.style.display = 'flex';
      
      // Limpar formulário e resetar para um item
      document.getElementById('mealForm').reset();
      document.getElementById('nutritionPreview').style.display = 'none';
      resetFoodItems();
    }
    
    function resetFoodItems() {
      const container = document.getElementById('foodItemsContainer');
      container.innerHTML = `
        <div class="food-item" data-item-index="0">
          <div class="form-group">
            <label for="foodSelect0">Alimento</label>
                      <select class="food-select" required>
              <option value="">Selecione um alimento</option>
              <option value="arroz_branco" data-calories="130" data-protein="2.5" data-carbs="28" data-fat="0.3" data-fiber="0.4">Arroz branco cozido</option>
              <option value="feijao_carioca" data-calories="77" data-protein="4.8" data-carbs="14" data-fat="0.5" data-fiber="8.5">Feijão carioca cozido</option>
              <option value="peito_frango" data-calories="165" data-protein="31" data-carbs="0" data-fat="3.6" data-fiber="0">Peito de frango grelhado</option>
              <option value="ovo_cozido" data-calories="155" data-protein="13" data-carbs="1.1" data-fat="11" data-fiber="0">Ovo cozido</option>
              <option value="batata_doce" data-calories="86" data-protein="1.6" data-carbs="20" data-fat="0.1" data-fiber="2.7">Batata doce cozida</option>
              <option value="banana_prata" data-calories="89" data-protein="1.1" data-carbs="23" data-fat="0.3" data-fiber="2.6">Banana prata</option>
              <option value="maca" data-calories="52" data-protein="0.3" data-carbs="14" data-fat="0.2" data-fiber="2.4">Maçã</option>
              <option value="brocolis" data-calories="35" data-protein="2.4" data-carbs="7" data-fat="0.4" data-fiber="3.3">Brócolis cozido</option>
              <option value="aveia_flocos" data-calories="389" data-protein="16.9" data-carbs="66" data-fat="6.9" data-fiber="8">Aveia em flocos</option>
              <option value="pao_frances" data-calories="270" data-protein="9" data-carbs="57" data-fat="3.4" data-fiber="2.3">Pão francês</option>
              <option value="queijo_mussarela" data-calories="280" data-protein="19" data-carbs="3" data-fat="21" data-fiber="0">Queijo mussarela</option>
              <option value="leite_integral" data-calories="61" data-protein="3.2" data-carbs="4.8" data-fat="3.2" data-fiber="0">Leite integral</option>
              <option value="iogurte_natural" data-calories="63" data-protein="3.5" data-carbs="4.7" data-fat="3.3" data-fiber="0">Iogurte natural</option>
              <option value="amendoas" data-calories="576" data-protein="21" data-carbs="22" data-fat="49" data-fiber="12.5">Amêndoas</option>
              <option value="castanha_para" data-calories="656" data-protein="14" data-carbs="12" data-fat="66" data-fiber="8.5">Castanha-do-pará</option>
              <option value="salmao_grelhado" data-calories="208" data-protein="20" data-carbs="0" data-fat="13" data-fiber="0">Salmão grelhado</option>
              <option value="carne_bovina" data-calories="250" data-protein="26" data-carbs="0" data-fat="15" data-fiber="0">Carne bovina (patinho)</option>
              <option value="quinoa_cozida" data-calories="120" data-protein="4.1" data-carbs="21" data-fat="1.9" data-fiber="2.8">Quinoa cozida</option>
              <option value="lentilha_cozida" data-calories="116" data-protein="9" data-carbs="20" data-fat="0.4" data-fiber="7.9">Lentilha cozida</option>
              <option value="abacate" data-calories="160" data-protein="2" data-carbs="8.5" data-fat="14.7" data-fiber="6.7">Abacate</option>
            </select>
          </div>
          
          <div class="form-group">
            <label for="quantity0">Quantidade (gramas)</label>
            <div class="quantity-input-group">
                        <input type="number" class="quantity-input" 
                     min="1" max="2000" value="100" required>
              <button type="button" class="remove-food-btn" onclick="removeFoodItem(0)" style="display: none;">
                <i class="fas fa-trash"></i>
              </button>
            </div>
          </div>
        </div>
      `;
      
      // Adicionar event listeners para o primeiro item
      addFoodItemEventListeners(0);
    }
    
    function addFoodItem() {
      const container = document.getElementById('foodItemsContainer');
      const currentItems = container.querySelectorAll('.food-item');
      const newIndex = currentItems.length;
      
      const newItem = document.createElement('div');
      newItem.className = 'food-item';
      newItem.setAttribute('data-item-index', newIndex);
      newItem.innerHTML = `
        <div class="form-group">
          <label for="foodSelect${newIndex}">Alimento</label>
                      <select class="food-select" required>
            <option value="">Selecione um alimento</option>
            <option value="arroz_branco" data-calories="130" data-protein="2.5" data-carbs="28" data-fat="0.3" data-fiber="0.4">Arroz branco cozido</option>
            <option value="feijao_carioca" data-calories="77" data-protein="4.8" data-carbs="14" data-fat="0.5" data-fiber="8.5">Feijão carioca cozido</option>
            <option value="peito_frango" data-calories="165" data-protein="31" data-carbs="0" data-fat="3.6" data-fiber="0">Peito de frango grelhado</option>
            <option value="ovo_cozido" data-calories="155" data-protein="13" data-carbs="1.1" data-fat="11" data-fiber="0">Ovo cozido</option>
            <option value="batata_doce" data-calories="86" data-protein="1.6" data-carbs="20" data-fat="0.1" data-fiber="2.7">Batata doce cozida</option>
            <option value="banana_prata" data-calories="89" data-protein="1.1" data-carbs="23" data-fat="0.3" data-fiber="2.6">Banana prata</option>
            <option value="maca" data-calories="52" data-protein="0.3" data-carbs="14" data-fat="0.2" data-fiber="2.4">Maçã</option>
            <option value="brocolis" data-calories="35" data-protein="2.4" data-carbs="7" data-fat="0.4" data-fiber="3.3">Brócolis cozido</option>
            <option value="aveia_flocos" data-calories="389" data-protein="16.9" data-carbs="66" data-fat="6.9" data-fiber="8">Aveia em flocos</option>
            <option value="pao_frances" data-calories="270" data-protein="9" data-carbs="57" data-fat="3.4" data-fiber="2.3">Pão francês</option>
            <option value="queijo_mussarela" data-calories="280" data-protein="19" data-carbs="3" data-fat="21" data-fiber="0">Queijo mussarela</option>
            <option value="leite_integral" data-calories="61" data-protein="3.2" data-carbs="4.8" data-fat="3.2" data-fiber="0">Leite integral</option>
            <option value="iogurte_natural" data-calories="63" data-protein="3.5" data-carbs="4.7" data-fat="3.3" data-fiber="0">Iogurte natural</option>
            <option value="amendoas" data-calories="576" data-protein="21" data-carbs="22" data-fat="49" data-fiber="12.5">Amêndoas</option>
            <option value="castanha_para" data-calories="656" data-protein="14" data-carbs="12" data-fat="66" data-fiber="8.5">Castanha-do-pará</option>
            <option value="salmao_grelhado" data-calories="208" data-protein="20" data-carbs="0" data-fat="13" data-fiber="0">Salmão grelhado</option>
            <option value="carne_bovina" data-calories="250" data-protein="26" data-carbs="0" data-fat="15" data-fiber="0">Carne bovina (patinho)</option>
            <option value="quinoa_cozida" data-calories="120" data-protein="4.1" data-carbs="21" data-fat="1.9" data-fiber="2.8">Quinoa cozida</option>
            <option value="lentilha_cozida" data-calories="116" data-protein="9" data-carbs="20" data-fat="0.4" data-fiber="7.9">Lentilha cozida</option>
            <option value="abacate" data-calories="160" data-protein="2" data-carbs="8.5" data-fat="14.7" data-fiber="6.7">Abacate</option>
          </select>
        </div>
        
        <div class="form-group">
          <label for="quantity${newIndex}">Quantidade (gramas)</label>
          <div class="quantity-input-group">
                        <input type="number" class="quantity-input" 
                   min="1" max="2000" value="100" required>
            <button type="button" class="remove-food-btn" onclick="removeFoodItem(${newIndex})">
              <i class="fas fa-trash"></i>
            </button>
          </div>
        </div>
      `;
      
      container.appendChild(newItem);
      addFoodItemEventListeners(newIndex);
      
      // Mostrar botões de remoção para todos os itens
      updateRemoveButtons();
    }
    
    function removeFoodItem(index) {
      const container = document.getElementById('foodItemsContainer');
      const items = container.querySelectorAll('.food-item');
      
      if (items.length > 1) {
        items[index].remove();
        updateRemoveButtons();
        updateNutritionPreview();
      }
    }
    
    function removeFoodItemFromEdit(index) {
      const container = document.getElementById('editFoodItemsContainer');
      const items = container.querySelectorAll('.food-item');
      
      if (items.length > 1) {
        items[index].remove();
        updateRemoveButtonsEdit();
        updateEditNutritionPreview();
      }
    }
    
    function updateRemoveButtonsEdit() {
      const container = document.getElementById('editFoodItemsContainer');
      const items = container.querySelectorAll('.food-item');
      
      items.forEach((item, index) => {
        const removeBtn = item.querySelector('.remove-food-btn');
        if (items.length > 1) {
          removeBtn.style.display = 'block';
        } else {
          removeBtn.style.display = 'none';
        }
      });
    }
    
    function addFoodItemToEdit() {
      const container = document.getElementById('editFoodItemsContainer');
      const currentItems = container.querySelectorAll('.food-item');
      const newIndex = currentItems.length;
      
      console.log('DEBUG: addFoodItemToEdit chamada');
      console.log('DEBUG: Container:', container);
      console.log('DEBUG: Itens atuais:', currentItems.length);
      console.log('DEBUG: Novo índice:', newIndex);
      
      const newItem = document.createElement('div');
      newItem.className = 'food-item';
      newItem.setAttribute('data-item-index', newIndex);
      newItem.innerHTML = `
        <div class="form-group">
          <label for="foodSelect${newIndex}">Alimento</label>
                      <select class="food-select" required>
            <option value="">Selecione um alimento</option>
            <option value="arroz_branco" data-calories="130" data-protein="2.5" data-carbs="28" data-fat="0.3" data-fiber="0.4">Arroz branco cozido</option>
            <option value="feijao_carioca" data-calories="77" data-protein="4.8" data-carbs="14" data-fat="0.5" data-fiber="8.5">Feijão carioca cozido</option>
            <option value="peito_frango" data-calories="165" data-protein="31" data-carbs="0" data-fat="3.6" data-fiber="0">Peito de frango grelhado</option>
            <option value="ovo_cozido" data-calories="155" data-protein="13" data-carbs="1.1" data-fat="11" data-fiber="0">Ovo cozido</option>
            <option value="batata_doce" data-calories="86" data-protein="1.6" data-carbs="20" data-fat="0.1" data-fiber="2.7">Batata doce cozida</option>
            <option value="banana_prata" data-calories="89" data-protein="1.1" data-carbs="23" data-fat="0.3" data-fiber="2.6">Banana prata</option>
            <option value="maca" data-calories="52" data-protein="0.3" data-carbs="14" data-fat="0.2" data-fiber="2.4">Maçã</option>
            <option value="brocolis" data-calories="35" data-protein="2.4" data-carbs="7" data-fat="0.4" data-fiber="3.3">Brócolis cozido</option>
            <option value="aveia_flocos" data-calories="389" data-protein="16.9" data-carbs="66" data-fat="6.9" data-fiber="8">Aveia em flocos</option>
            <option value="pao_frances" data-calories="270" data-protein="9" data-carbs="57" data-fat="3.4" data-fiber="2.3">Pão francês</option>
            <option value="queijo_mussarela" data-calories="280" data-protein="19" data-carbs="3" data-fat="21" data-fiber="0">Queijo mussarela</option>
            <option value="leite_integral" data-calories="61" data-protein="3.2" data-carbs="4.8" data-fat="3.2" data-fiber="0">Leite integral</option>
            <option value="iogurte_natural" data-calories="63" data-protein="3.5" data-carbs="4.7" data-fat="3.3" data-fiber="0">Iogurte natural</option>
            <option value="amendoas" data-calories="576" data-protein="21" data-carbs="22" data-fat="49" data-fiber="12.5">Amêndoas</option>
            <option value="castanha_para" data-calories="656" data-protein="14" data-carbs="12" data-fat="66" data-fiber="8.5">Castanha-do-pará</option>
            <option value="salmao_grelhado" data-calories="208" data-protein="20" data-carbs="0" data-fat="13" data-fiber="0">Salmão grelhado</option>
            <option value="carne_bovina" data-calories="250" data-protein="26" data-carbs="0" data-fat="15" data-fiber="0">Carne bovina (patinho)</option>
            <option value="quinoa_cozida" data-calories="120" data-protein="4.1" data-carbs="21" data-fat="1.9" data-fiber="2.8">Quinoa cozida</option>
            <option value="lentilha_cozida" data-calories="116" data-protein="9" data-carbs="20" data-fat="0.4" data-fiber="7.9">Lentilha cozida</option>
            <option value="abacate" data-calories="160" data-protein="2" data-carbs="8.5" data-fat="14.7" data-fiber="6.7">Abacate</option>
          </select>
        </div>
        
        <div class="form-group">
          <label for="quantity${newIndex}">Quantidade (gramas)</label>
          <div class="quantity-input-group">
                        <input type="number" class="quantity-input" 
                   min="1" max="2000" value="100" required>
            <button type="button" class="remove-food-btn" onclick="removeFoodItemFromEdit(${newIndex})">
              <i class="fas fa-trash"></i>
            </button>
          </div>
        </div>
      `;
      
      container.appendChild(newItem);
      
      console.log('DEBUG: Item adicionado ao DOM');
      console.log('DEBUG: Itens após adição:', container.querySelectorAll('.food-item').length);
      
      // Adicionar event listeners
      addFoodItemEventListenersForEdit(newIndex);
      
      // Mostrar botões de remoção se necessário
      updateRemoveButtonsEdit();
      
      // Atualizar preview nutricional
      updateEditNutritionPreview();
      
      console.log('DEBUG: addFoodItemToEdit concluída');
    }
    
    function updateRemoveButtons() {
      const container = document.getElementById('foodItemsContainer');
      const items = container.querySelectorAll('.food-item');
      
      items.forEach((item, index) => {
        const removeBtn = item.querySelector('.remove-food-btn');
        if (items.length > 1) {
          removeBtn.style.display = 'block';
        } else {
          removeBtn.style.display = 'none';
        }
      });
    }
    
    function addFoodItemEventListeners(index) {
      const container = document.getElementById('foodItemsContainer');
      const item = container.querySelector(`[data-item-index="${index}"]`);
      
      if (item) {
        const foodSelect = item.querySelector('.food-select');
        const quantityInput = item.querySelector('.quantity-input');
        
        if (foodSelect && quantityInput) {
          foodSelect.addEventListener('change', updateNutritionPreview);
          quantityInput.addEventListener('input', updateNutritionPreview);
        }
      }
    }
    
    function addFoodItemEventListenersForEdit(index) {
      const container = document.getElementById('editFoodItemsContainer');
      const item = container.querySelector(`[data-item-index="${index}"]`);
      
      if (item) {
        const foodSelect = item.querySelector('.food-select');
        const quantityInput = item.querySelector('.quantity-input');
        
        if (foodSelect && quantityInput) {
          foodSelect.addEventListener('change', updateEditNutritionPreview);
          quantityInput.addEventListener('input', updateEditNutritionPreview);
        }
      }
    }
    
    function clearDay() {
      // Mostrar modal de confirmação personalizado
      showClearDayModal();
    }
    
    function showClearDayModal() {
      const modal = document.getElementById('clearDayModal');
      const body = document.body;
      
      // Prevenir scroll da página de fundo
      body.style.overflow = 'hidden';
      
      modal.style.display = 'flex';
    }
    
    function closeClearDayModal() {
      const modal = document.getElementById('clearDayModal');
      const body = document.body;
      
      // Restaurar scroll da página
      body.style.overflow = 'auto';
      
      modal.style.display = 'none';
    }
    
    function confirmClearDay() {
      // Implementar limpeza do dia
      console.log('Limpando dados do dia...');
      
      // Fechar modal de confirmação
      closeClearDayModal();
      
      // Mostrar modal de sucesso personalizado
      showClearDaySuccessModal();
      
      // Fazer requisição para limpar o dia após 1 segundo
      setTimeout(() => {
        clearDayRequest();
      }, 1000);
    }
    
    function clearDayRequest() {
      // Obter data atual
      const currentDate = document.getElementById('currentDate').textContent;
      const dateStr = currentDate.split(' ')[0]; // Pegar apenas a data
      
      console.log('Enviando requisição para limpar dia:', dateStr);
      
      // Criar FormData
      const formData = new FormData();
      formData.append('date', dateStr);
      
      // Fazer requisição
      fetch('{% url "clear_day" %}', {
        method: 'POST',
        body: formData,
        headers: {
          'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value
        }
      })
      .then(response => response.json())
      .then(data => {
        if (data.success) {
          console.log('Dia limpo com sucesso:', data.message);
          console.log('Refeições removidas:', data.deleted_count);
          
          // Atualizar mensagem de sucesso com detalhes
          updateClearDaySuccessMessage(data.deleted_count);
          
          // Recarregar página após 2 segundos
          setTimeout(() => {
            location.reload();
          }, 2000);
        } else {
          console.error('Erro ao limpar dia:', data.error);
          showErrorModal('Erro ao limpar dia: ' + data.error);
        }
      })
      .catch(error => {
        console.error('Erro na requisição:', error);
        showErrorModal('Erro de conexão. Tente novamente.');
      });
    }
    
    function updateClearDaySuccessMessage(deletedCount) {
      const modal = document.getElementById('mealSuccessModal');
      const title = modal.querySelector('.modal-title');
      const message = modal.querySelector('.modal-message');
      
      title.textContent = 'Dia Limpo!';
      
      if (deletedCount > 0) {
        message.textContent = `${deletedCount} refeições foram removidas com sucesso!`;
      } else {
        message.textContent = 'Nenhuma refeição encontrada para remover.';
      }
      
      // Auto-fechar após 3 segundos
      setTimeout(() => {
        closeMealSuccessModal();
      }, 3000);
    }
    
    function showClearDaySuccessModal() {
      const modal = document.getElementById('mealSuccessModal');
      const body = document.body;
      
      // Prevenir scroll da página de fundo
      body.style.overflow = 'hidden';
      
      // Atualizar mensagem
      const title = modal.querySelector('.modal-title');
      const message = modal.querySelector('.modal-message');
      
      title.textContent = 'Limpando Dia...';
      message.textContent = 'Removendo todas as refeições do dia...';
      
      modal.style.display = 'flex';
      
      // Não fechar automaticamente - será fechado pela função de sucesso
    }
    
    function showErrorModal(message) {
      const modal = document.getElementById('errorModal');
      const body = document.body;
      
      // Prevenir scroll da página de fundo
      body.style.overflow = 'hidden';
      
      // Atualizar mensagem
      const messageElement = modal.querySelector('#errorMessage');
      messageElement.textContent = message;
      
      modal.style.display = 'flex';
      
      // Auto-fechar após 5 segundos
      setTimeout(() => {
        closeErrorModal();
      }, 5000);
    }
    
    function editMeal(mealId) {
      console.log('DEBUG: Iniciando edição da refeição', mealId);
      
      // Armazenar o ID da refeição para edição
      window.currentMealToEdit = mealId;
      
      // Buscar dados da refeição
      fetch(`/inicio/api/meals/${mealId}/`, {
        method: 'GET'
      })
      .then(response => {
        console.log('DEBUG: Response status:', response.status);
        return response.json();
      })
      .then(data => {
        console.log('DEBUG: Response data:', data);
        if (data.success) {
          console.log('DEBUG: Dados carregados com sucesso, populando modal');
          // Preencher modal com dados da refeição
          populateEditModal(data.meal);
          // Abrir modal de edição
          openEditMealModal();
        } else {
          console.log('DEBUG: Erro nos dados:', data.error);
          showErrorModal('Erro ao carregar dados da refeição: ' + data.error);
        }
      })
      .catch(error => {
        console.error('DEBUG: Erro na requisição:', error);
        showErrorModal('Erro ao carregar dados da refeição. Tente novamente.');
      });
    }
    
    function saveEditedMeal() {
      const mealId = window.currentMealToEdit;
      
      if (!mealId) {
        showErrorModal('Erro: ID da refeição não encontrado.');
        return;
      }
      
      // Validar nome da refeição
      const mealName = document.getElementById('editMealName').value.trim();
      if (!mealName) {
        showErrorModal('Por favor, digite um nome para a refeição.');
        return;
      }
      
      // Coletar todos os alimentos
      const container = document.getElementById('editFoodItemsContainer');
      const items = container.querySelectorAll('.food-item');
      const foods = [];
      
      console.log('DEBUG: Encontrados', items.length, 'itens .food-item');
      console.log('DEBUG: Container:', container);
      console.log('DEBUG: Items encontrados:', items);
      
      items.forEach((item, index) => {
        console.log(`DEBUG: Processando item ${index}:`, item);
        console.log(`DEBUG: HTML do item ${index}:`, item.outerHTML);
        
        const foodSelect = item.querySelector('.food-select');
        const quantityInput = item.querySelector('.quantity-input');
        
        console.log(`DEBUG: Item ${index}:`, {
          foodSelect: foodSelect,
          quantityInput: quantityInput,
          foodSelectValue: foodSelect ? foodSelect.value : 'não encontrado',
          quantityInputValue: quantityInput ? quantityInput.value : 'não encontrado',
          foodSelectExists: !!foodSelect,
          quantityInputExists: !!quantityInput
        });
        
        if (foodSelect && foodSelect.value && quantityInput && quantityInput.value && 
            foodSelect.value.trim() !== '' && quantityInput.value.trim() !== '') {
          console.log(`DEBUG: Adicionando alimento ${index}:`, {
            food_id: foodSelect.value,
            quantity: parseFloat(quantityInput.value)
          });
          foods.push({
            food_id: foodSelect.value,
            quantity: parseFloat(quantityInput.value)
          });
        } else {
          console.log(`DEBUG: Item ${index} não passou na validação:`, {
            foodSelectExists: !!foodSelect,
            foodSelectValue: foodSelect ? foodSelect.value : null,
            foodSelectValueTrimmed: foodSelect ? foodSelect.value.trim() : null,
            quantityInputExists: !!quantityInput,
            quantityInputValue: quantityInput ? quantityInput.value : null,
            quantityInputValueTrimmed: quantityInput ? quantityInput.value.trim() : null
          });
        }
      });
      
      console.log('DEBUG: Foods coletados:', foods);
      
      if (foods.length === 0) {
        console.log('DEBUG: Refeição sem alimentos - permitindo edição');
        // Permitir refeições sem alimentos
      }
      
      // Adicionar data atual
      const today = new Date();
      const year = today.getFullYear();
      const month = String(today.getMonth() + 1).padStart(2, '0');
      const day = String(today.getDate()).padStart(2, '0');
      const dateString = `${year}-${month}-${day}`;
      
      // Criar FormData manualmente
      const formData = new FormData();
      formData.append('meal_name', document.getElementById('editMealName').value);
      formData.append('date', dateString);
      formData.append('foods', JSON.stringify(foods));
      
      // Debug: mostrar dados que serão enviados
      console.log('Dados sendo enviados:');
      console.log('mealId:', mealId);
      console.log('foods:', foods);
      console.log('foods JSON:', JSON.stringify(foods));
      console.log('date:', dateString);
      
      // Verificar se o FormData está correto
      console.log('FormData contents:');
      for (let [key, value] of formData.entries()) {
        console.log(`${key}: ${value}`);
      }
      
      // Debug adicional
      console.log('DEBUG: FormData keys:', Array.from(formData.keys()));
      console.log('DEBUG: FormData values:', Array.from(formData.values()));
      console.log('DEBUG: foods array length:', foods.length);
      console.log('DEBUG: foods array content:', foods);
      
      // Mostrar loading
      const submitBtn = document.querySelector('button[onclick="saveEditedMeal()"]');
      const originalText = submitBtn.textContent;
      submitBtn.textContent = 'Salvando...';
      submitBtn.disabled = true;
      
      // Enviar dados para o servidor
      fetch(`/inicio/api/meals/${mealId}/edit/`, {
        method: 'POST',
        body: formData,
        headers: {
          'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value
        }
      })
      .then(response => {
        console.log('Response status:', response.status);
        if (!response.ok) {
          throw new Error(`HTTP error! status: ${response.status}`);
        }
        return response.json();
      })
                  .then(data => {
                    console.log('Response data:', data);
                    if (data.success) {
                      // Fechar modal de edição
                      closeEditMealModal();
                      
                      // Mostrar modal de sucesso personalizado
                      showMealSuccessModal('Refeição editada com sucesso!');
                      
                      // Definir flag para recarregar a página após fechar o modal de sucesso
                      window.shouldReloadPage = true;
                    } else {
                      showErrorModal('Erro ao editar refeição: ' + data.error);
                    }
                  })
      .catch(error => {
        console.error('Erro:', error);
        showErrorModal('Erro ao editar refeição. Verifique sua conexão e tente novamente.');
      })
      .finally(() => {
        // Restaurar botão
        submitBtn.textContent = originalText;
        submitBtn.disabled = false;
      });
    }
    
    function populateEditModal(meal) {
      console.log('DEBUG: Populando modal com dados:', meal);
      
      // Preencher nome da refeição
      document.getElementById('editMealName').value = meal.name;
      
      // Limpar container de alimentos
      const container = document.getElementById('editFoodItemsContainer');
      container.innerHTML = '';
      
      console.log('DEBUG: Adicionando', meal.items.length, 'itens ao modal');
      
      // Adicionar cada alimento da refeição
      meal.items.forEach((item, index) => {
        console.log(`DEBUG: Adicionando item ${index}:`, item);
        addFoodItemToEditWithData(item, index);
      });
      
      // Atualizar preview nutricional
      updateEditNutritionPreview();
    }
    
    function addFoodItemToEditWithData(item, index) {
      const container = document.getElementById('editFoodItemsContainer');
      
      const newItem = document.createElement('div');
      newItem.className = 'food-item';
      newItem.setAttribute('data-item-index', index);
      newItem.innerHTML = `
        <div class="form-group">
          <label for="foodSelect${index}">Alimento</label>
                      <select class="food-select" required>
            <option value="">Selecione um alimento</option>
            <option value="arroz_branco" data-calories="130" data-protein="2.5" data-carbs="28" data-fat="0.3" data-fiber="0.4">Arroz branco cozido</option>
            <option value="feijao_carioca" data-calories="77" data-protein="4.8" data-carbs="14" data-fat="0.5" data-fiber="8.5">Feijão carioca cozido</option>
            <option value="peito_frango" data-calories="165" data-protein="31" data-carbs="0" data-fat="3.6" data-fiber="0">Peito de frango grelhado</option>
            <option value="ovo_cozido" data-calories="155" data-protein="13" data-carbs="1.1" data-fat="11" data-fiber="0">Ovo cozido</option>
            <option value="batata_doce" data-calories="86" data-protein="1.6" data-carbs="20" data-fat="0.1" data-fiber="2.7">Batata doce cozida</option>
            <option value="banana_prata" data-calories="89" data-protein="1.1" data-carbs="23" data-fat="0.3" data-fiber="2.6">Banana prata</option>
            <option value="maca" data-calories="52" data-protein="0.3" data-carbs="14" data-fat="0.2" data-fiber="2.4">Maçã</option>
            <option value="brocolis" data-calories="35" data-protein="2.4" data-carbs="7" data-fat="0.4" data-fiber="3.3">Brócolis cozido</option>
            <option value="aveia_flocos" data-calories="389" data-protein="16.9" data-carbs="66" data-fat="6.9" data-fiber="8">Aveia em flocos</option>
            <option value="pao_frances" data-calories="270" data-protein="9" data-carbs="57" data-fat="3.4" data-fiber="2.3">Pão francês</option>
            <option value="queijo_mussarela" data-calories="280" data-protein="19" data-carbs="3" data-fat="21" data-fiber="0">Queijo mussarela</option>
            <option value="leite_integral" data-calories="61" data-protein="3.2" data-carbs="4.8" data-fat="3.2" data-fiber="0">Leite integral</option>
            <option value="iogurte_natural" data-calories="63" data-protein="3.5" data-carbs="4.7" data-fat="3.3" data-fiber="0">Iogurte natural</option>
            <option value="amendoas" data-calories="576" data-protein="21" data-carbs="22" data-fat="49" data-fiber="12.5">Amêndoas</option>
            <option value="castanha_para" data-calories="656" data-protein="14" data-carbs="12" data-fat="66" data-fiber="8.5">Castanha-do-pará</option>
            <option value="salmao_grelhado" data-calories="208" data-protein="20" data-carbs="0" data-fat="13" data-fiber="0">Salmão grelhado</option>
            <option value="carne_bovina" data-calories="250" data-protein="26" data-carbs="0" data-fat="15" data-fiber="0">Carne bovina (patinho)</option>
            <option value="quinoa_cozida" data-calories="120" data-protein="4.1" data-carbs="21" data-fat="1.9" data-fiber="2.8">Quinoa cozida</option>
            <option value="lentilha_cozida" data-calories="116" data-protein="9" data-carbs="20" data-fat="0.4" data-fiber="7.9">Lentilha cozida</option>
            <option value="abacate" data-calories="160" data-protein="2" data-carbs="8.5" data-fat="14.7" data-fiber="6.7">Abacate</option>
          </select>
        </div>
        
        <div class="form-group">
          <label for="quantity${index}">Quantidade (gramas)</label>
          <div class="quantity-input-group">
                        <input type="number" class="quantity-input" 
                   min="1" max="2000" value="${item.quantity}" required>
            <button type="button" class="remove-food-btn" onclick="removeFoodItemFromEdit(${index})">
              <i class="fas fa-trash"></i>
            </button>
          </div>
        </div>
      `;
      
      container.appendChild(newItem);
      
      // Selecionar o alimento correto
      const foodSelect = newItem.querySelector('.food-select');
      foodSelect.value = item.food_id;
      
      
      // Adicionar event listeners
      addFoodItemEventListenersForEdit(index);
      
      // Mostrar botões de remoção se necessário
      updateRemoveButtonsEdit();
    }
    
    function openEditMealModal() {
      const modal = document.getElementById('editMealModal');
      const body = document.body;
      
      if (!modal) {
        console.error('Modal de edição não encontrado!');
        return;
      }
      
      // Prevenir scroll da página de fundo
      body.style.overflow = 'hidden';
      
      modal.style.display = 'flex';
    }
    
    function deleteMeal(mealId) {
      console.log('DEBUG: deleteMeal chamada com mealId:', mealId);
      console.log('DEBUG: tipo do mealId:', typeof mealId);
      
      // Armazenar o ID da refeição para usar na confirmação
      window.currentMealToDelete = mealId;
      
      console.log('DEBUG: mealId armazenado em window.currentMealToDelete:', window.currentMealToDelete);
      
      // Mostrar modal de confirmação personalizado
      showDeleteConfirmModal();
    }
    
    function showDeleteConfirmModal() {
      const modal = document.getElementById('deleteConfirmModal');
      const body = document.body;
      
      // Prevenir scroll da página de fundo
      body.style.overflow = 'hidden';
      
      modal.style.display = 'flex';
    }
    
    function closeDeleteConfirmModal() {
      const modal = document.getElementById('deleteConfirmModal');
      const body = document.body;
      
      // Restaurar scroll da página
      body.style.overflow = 'auto';
      
      modal.style.display = 'none';
      
      // Limpar variável
      window.currentMealToDelete = null;
    }
    
    function confirmDeleteMeal() {
      const mealId = window.currentMealToDelete;
      
      console.log('DEBUG: confirmDeleteMeal chamada');
      console.log('DEBUG: mealId:', mealId);
      console.log('DEBUG: tipo do mealId:', typeof mealId);
      
      if (!mealId) {
        console.log('DEBUG: mealId não encontrado, fechando modal');
        closeDeleteConfirmModal();
        return;
      }
      
      // Fechar modal de confirmação
      closeDeleteConfirmModal();
      
      // Mostrar loading
      const deleteBtn = document.querySelector('.modal-btn.danger');
      const originalText = deleteBtn.textContent;
      deleteBtn.textContent = 'Excluindo...';
      deleteBtn.disabled = true;
      
      console.log('DEBUG: Fazendo requisição para excluir refeição:', mealId);
      
      // Fazer requisição de exclusão
      fetch(`{% url 'delete_meal' 0 %}`.replace('0', mealId), {
        method: 'DELETE',
        headers: {
          'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value
        }
      })
      .then(response => {
        console.log('DEBUG: Response status:', response.status);
        return response.json();
      })
      .then(data => {
        console.log('DEBUG: Response data:', data);
        if (data.success) {
          // Mostrar modal de sucesso
          showMealSuccessModal();
          
          // Definir flag para recarregar a página após fechar o modal de sucesso
          window.shouldReloadPage = true;
        } else {
          console.log('DEBUG: Erro na exclusão:', data.error);
          showErrorModal('Erro ao excluir refeição: ' + data.error);
        }
      })
      .catch(error => {
        console.error('DEBUG: Erro na requisição:', error);
        showErrorModal('Erro ao excluir refeição. Tente novamente.');
      })
      .finally(() => {
        // Restaurar botão
        deleteBtn.textContent = originalText;
        deleteBtn.disabled = false;
      });
    }
    
    function testProgress() {
      console.log('=== TESTE DE PROGRESSO ===');
      
      // Verificar valores atuais
      console.log('Valores atuais:');
      console.log('  - Calorias consumidas:', document.getElementById('caloriesConsumed').textContent);
      console.log('  - Carboidratos consumidos:', document.getElementById('carbsConsumed').textContent);
      console.log('  - Proteínas consumidas:', document.getElementById('proteinConsumed').textContent);
      console.log('  - Gorduras consumidas:', document.getElementById('fatConsumed').textContent);
      console.log('  - Fibras consumidas:', document.getElementById('fiberConsumed').textContent);
      
      // Forçar valores de teste (ultrapassando várias metas)
      document.getElementById('caloriesConsumed').textContent = '3000'; // Ultrapassando meta de 2375
      document.getElementById('carbsConsumed').textContent = '300'; // Ultrapassando meta de 267
      document.getElementById('proteinConsumed').textContent = '200'; // Ultrapassando meta de 178
      document.getElementById('fatConsumed').textContent = '100'; // Ultrapassando meta de 66
      document.getElementById('fiberConsumed').textContent = '50'; // Ultrapassando meta de 30
      
      console.log('Valores de teste aplicados (ultrapassando várias metas):');
      console.log('  - Calorias: 3000/2375 (+625)');
      console.log('  - Carboidratos: 300/267 (+33)');
      console.log('  - Proteínas: 200/178 (+22)');
      console.log('  - Gorduras: 100/66 (+34)');
      console.log('  - Fibras: 50/30 (+20)');
      
      // Atualizar progressos
      updateProgressCircle();
      updateMacroProgress();
      
      console.log('Progressos atualizados - círculo deve estar VERMELHO e cards devem mostrar ultrapassagem!');
    }
  </script>
</body>
</html>